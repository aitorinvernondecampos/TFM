---
# T√≠tulo: Assessing the properties of asymptotic PERMANOVA
#         test through comprehensive simulations in the
#         context of genetic studies
# T√≠tulo corto: Properties of asymptotic PERMANOVA
# Autor: Aitor Invern√≥n de Campos
# Nombre Tutores: Miquel Calvo Llorca y Diego Garrido-Mart√≠n 
# Nombre Profesorado Responsable Asignatura: David Merino Arranz
# Titulaci√≥n: M√°ster universitario de Bioinform√°tica y Bioestad√≠stica (UOC, UB)
# √Årea del trabajo: Analisis de datos √ìmicos

title: 'TFM: Properties of asymptotic PERMANOVA'
lang: es
author: |
  | <font size="4"> Aitor Invern√≥n de Campos </font>
  | <font size="2"> aitorinvernondecampos@uoc.edu </font>
  | <font size="2">  </font>  
  | <font size="2"> M√†ster universitari en Bioinform√†tica i Bioestad√≠stica UOC-UB </font>
date: "`r format(Sys.time(), '%d %m %Y')`"
# Fecha en Espa√±ol: Sys.setlocale("LC_TIME", "es_ES.UTF-8")
# Data en Catal√†: Sys.setlocale("LC_TIME", "ca_ES.UTF-8")

header-includes:
\renewcommand{\tablename}{Tabla}
\renewcommand{\figurename}{Figura}
\usepackage{float}
\floatplacement{figure}{H}
\usepackage[spanish]{babel}  
output:
  pdf_document:
  toc: yes
number_sections: yes
toc_depth: 2
fig_width: 5.5
fig_height: 5
fig_caption: yes
highlight: tango
df_print: tibble
citation_package: natbib
latex_engine: xelatex
dev: cairo_pdf # Permet mostrar s√≠mbols Unicode a les gr√†fiques.
extra_dependencies:
  caption: ["font=footnotesize", "labelfont={bf}", "justification=centering"]
bookdown::pdf_book:
  html_document:
  toc: yes
number_sections: yes
toc_depth: 2
fig_width: 7
fig_height: 6
fig_caption: yes
highlight: tango
df_print: paged
toc-title: "Contenidos"
linkcolor: 'blue'
link-citations: yes
---

```{r packginstall, include = FALSE}
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # 
#                Instalaci√≥n de los paquetes necesarios                   #
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # 

install.packages("stargazer")

# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #

```


```{r setup, include = FALSE}
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # 
# Configuraci√≥n del "chunk" para mostrar el c√≥digo + centrar las figuras  #
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # 

knitr::opts_chunk$set(echo = TRUE, fig.align="center")

# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #

```

```{r wrap-hook, include = FALSE}
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # 
#  Permite modificar la longitud de cada l√≠nia de resultados del "chunk"  #
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # 

library(knitr)
hook_output = knit_hooks$get('output')
knit_hooks$set(output = function(x, options) {
  # this hook is used only when the linewidth option is not NULL
  if (!is.null(n <- options$linewidth)) {
    x = knitr:::split_lines(x)
    # any lines wider than n should be wrapped
    if (any(nchar(x) > n)) x = strwrap(x, width = n)
    x = paste(x, collapse = '\n')
  }
  hook_output(x, options)
})

# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #

```


Creaci√≥n de las tablas de la memoria del TFM


```{r TablasGr√°ficos, message = FALSE, echo = FALSE, results = 'asis', warning = F, include = FALSE}
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
#                 Tabla y Gr√°ficos Datos Simulaci√≥n                       #
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #

# Listados de las variables necesarias y sus equivalencias:
# ---------------------------------------------------------
list(# FIJAS: a priori, no deber√≠an influir en los resultados.
  "modelSim" <- "mvnorm", # m_values ‚àà c("mvnorm", "simplex", "multinom")
  "a" <- 2, # a_values ‚àà c(1:6)
  "b" <- 3, # b_values ‚àà c(1:6)
  "u" <- 1, # u_values ‚àà c(seq(0.1, 2, 0.1))
  "w" <- "B", # w_values ‚àà c("A", "B", "AB")
  "hk" <- 1,
  "k" <- 0, # k_values ‚àà c(0, 1)
  "plotheatmap" <- F, # plotheatmap_values ‚àà as.logical(c("F", "T"))
  "D" <- "unif-0-1",
  "l" <- 1000,
  "s" <- 0.1,
  "p" <- 1,
  "pdist" <- "norm", # pdist_values ‚àà c("norm", "gamma", "beta")
  "x" <- 10,
  # VARIABLES: a estudiar su potencial influencia en los resultados. 
  "Alpha_values" <- c(0.05, 0.01, 0.001), # Niveles de significaci√≥n (Œ±) m√°s comunes.
  "S_values" <- c(1E2, 1E3, 1E4), # N√∫mero de simulaciones, aumentar S deber√≠a aumentar la precisi√≥n.
                                  # M√°x. 1E4 si se quiere aumentar la precisi√≥n sin elevar el tiempo de computaci√≥n.
  "n_values" <- c(seq(200, 400, 100)), # Tama√±o de la muestra.
                                       # Valor que equilibra la representatividad de los resultados con el tiempo de computaci√≥n.
  "Var_values" <- c("Equal", "Unequal Type I", "Unequal Type II", "Unequal Type III"), # Varianza de las variables de Y.
                                                                                       # Ver "Sim.mvnorm" para detalles
  "q_values" <- c(3), # N√∫mero de respuestas .ùúè. para q > 5 "SITIOS EXTRA√ëOS"!
                      # Variable <=> "simplex" .ùúè. c(3, 5, 8, 10)
                      #              ‚àÄ q ‚àà "qlocstdev.norm.tsv" [c(2, 3, 5, 8, 10, 12, 15, 20, 25)]
                      # No aplica <=> "mvnorm" .ùúè. c(3)
  "loc_values" <- c(NA), # Ubicaci√≥n del modelo generador "simplex" (p / position / loc).
                         # e.g. Si (loc = 1/3) ‚â°> "Centro del simplex" | (loc -> 1) ‚â°> "V√©rtice del simplex"
                         # Variable <=> "simplex" .ùúè. c(1, 2, 3, 5, 8, 10)
                         #              ‚àÄ loc ‚àà "qlocstdev.norm.tsv" [c(1, 2, 3, 5, 8, 10)]
                         # No aplica <=> "mvnorm" .ùúè. c(NA)
  "delta_values" <- c(seq(0, 0.35, 0.0175)), # delta (‚àÜ) => Œî = 0 eval√∫a H0 y Œî > 0 evaluar√° H1.
                                             # El "step" usado depende de la prueba-error del m√©todo para diferentes Œî ‚â† 0,
                                             # teniendo en cuenta c√≥mo la [Potencia -> 1] en cada m√©todo.
  "Cor_values" <- c(seq(0, 0.8, 0.2)), # Correlaci√≥n de las variables del conjunto de datos Y (Cor).
                                       # Siempre: 0 <= Cor < 1
                                       # Variable <=> "mvnorm" .ùúè. c(seq(0, 0.8, 0.2))
                                       # No aplica <=> "simplex" .ùúè. c(NA)
  "lambda_values" <- c(NA) # Par√°metro lambda (distrib. Poisson).
                           # Variable <=> "multinom" .ùúè. c(seq(200, 1200, 200))
                           # No aplica <=> "mvnorm" y en "simplex" .ùúè. c(NA)
)

list(# Equivalencias de algunas variables:
  "chunk" <- k,
  "DistDef" <- dd <- D,
  "p_dist" <- pdist,
  "heterosk" <- H <- hk,
  "cores" <- x,
  "fx" <- f)

# N√∫mero total de simulaciones:
Nmax_simul <- length(Alpha_values)*length(S_values)*length(n_values)*
  length(Var_values)*length(q_values)*length(loc_values)*
  length(delta_values)*length(Cor_values)*length(lambda_values)

# Restringimos los valores a simular:
Alpha_values_sim <- Alpha_values[1]
S_values_sim <- S_values[2]
n_values_sim <- n_values[2]
Var_values_sim <- Var_values[]
q_values_sim <- q_values[]
loc_values_sim <- loc_values[]
delta_values_sim <- delta_values[]
Cor_values_sim <- Cor_values[]
lambda_values_sim <- lambda_values[]

# ---------------------------------------------------------

# DF Sim:
# -------
DF_names <- c("Nivel de significaci√≥n",
              "N√∫mero de simulaciones",
              "Tama√±o de la muestra",
              "Tipo de varianza",
              "N√∫mero de respuestas",
              # "Localizaci√≥n del s√≠mplex",
              "Par√°metro de generaci√≥n de H1",
              "Correlaci√≥n de las variables"
)

DF_sym <- c("alpha",
            "S",
            "n",
            "Var",
            "q",
            # "loc",
            "Delta",
            "Cor"
)

DF_values <- c(toString(Alpha_values_sim),
               toString(S_values_sim),
               toString(n_values_sim),
               toString(Var_values_sim),
               toString(q_values_sim),
               # toString(loc_values_sim),
               toString(paste0("De ", delta_values_sim[1],
                               " a ", delta_values_sim[length(delta_values_sim)],
                               " con un paso de ", delta_values_sim[2]-delta_values_sim[1],
                               " (", length(delta_values_sim), " valores)")),
               toString(Cor_values_sim)
)

DFSim1 <- data.frame(Variables = DF_names,
                     S√≠mbolo = DF_sym,
                     Valores = DF_values,
                     row.names = NULL)

colnames(DFSim1) <- c("Variable", "S√≠mbolo", "Valores")

# -------

# Otros
# -----
NumSimFinal <- length(Alpha_values_sim)*length(S_values_sim)*length(n_values_sim)*
  length(Var_values_sim)*length(q_values_sim)*length(loc_values_sim)*
  length(delta_values_sim)*length(Cor_values_sim)*length(lambda_values_sim)
  
library(stargazer)
stargazer(DFSim1, type = 'latex', summary=FALSE, rownames=FALSE,
          header=FALSE, title="Primera simulaci√≥n del primer objetivo: $\\alpha = 0.05$; 
          $S = 1000$; $n = 300$; $q = 3$; combinaciones $\\Delta - Var$",
          label="tab:TabSim1", font.size = "scriptsize", single.row = TRUE,
          column.sep.width = "-8pt", digits=2, no.space = TRUE)

# -----




# # # # # # # # # # # # # # # # # # # # # # # #
#             Simulaciones mvnorm             #
#                                             #
#        "Sim. 31-12-2023 20 h 10 min"        #
#                      +                      #
#        "Sim. 08-01-2024 19 h 19 min"        #
#                                             #
# # # # # # # # # # # # # # # # # # # # # # # #
#       Matriz de correlaci√≥n homog√©nea       #
#    (mismo valor Cor fuera de la diagonal)   #
# # # # # # # # # # # # # # # # # # # # # # # #
#         Œ± = (0.05, 0.01, 0.001)             #
# # # # # # # # # # # # # # # # # # # # # # # #
# ---------------------------------------------
# Directorio de trabajo principal.
work_dir <- "/Users/aitor/Desktop/RProjects/TFMgit"
setwd(work_dir)

# Directorio de la primera simulaci√≥n a representar:
setwd(file.path(getwd(), "Resultados/Modelo mvnorm/Sim. 31-12-2023 20 h 10 min"))
DF_Results_Graph_2graph1 <- read.csv("DF_Results_Graph.csv")

# Directorio de trabajo principal.
work_dir <- "/Users/aitor/Desktop/RProjects/TFMgit"
setwd(work_dir)

# Directorio de la segunda simulaci√≥n a representar:
setwd(file.path(getwd(), "Resultados/Modelo mvnorm/Sim. 08-01-2024 19 h 19 min"))
DF_Results_Graph_2graph2 <- read.csv("DF_Results_Graph.csv")

# Directorio de trabajo principal.
work_dir <- "/Users/aitor/Desktop/RProjects/TFMgit"
setwd(work_dir)

# Directorio de la uni√≥n de simulaciones:
setwd(file.path(getwd(), "Resultados/Modelo mvnorm/Resultados Memoria"))

# Uni√≥n de los DF:
DF_Results_Graph_2graph <- rbind(DF_Results_Graph_2graph1, DF_Results_Graph_2graph2)
DF_Results_Graph_2graph <- DF_Results_Graph_2graph[order(DF_Results_Graph_2graph$M√©todo), ]

## Para mvnorm forzamos que todos los valores de loc y lambda son NA.
DF_Results_Graph_2graph$loc <- c(rep(NA, dim(DF_Results_Graph_2graph)[1]))
DF_Results_Graph_2graph$lambda <- c(rep(NA, dim(DF_Results_Graph_2graph)[1]))

## Para mvnorm no se aplicar√° ni Yscaled ni YnormMinMax ya que se genera otro estad√≠stico diferente al que se est√° estudiando
## (p_valor) y que, a parte de que no tiene porque ser invariante a transformaciones, NO SIRVE PARA COMPARAR MANTA-MANOVA.
## Para simplex solo se estudiar√° MANTA, as√≠ que no es necesario corregir ni Ylog ni Yclr.

# => Filtramos las transformaciones no necesarias:
# .ùúè. unique(DF_Results_Graph_2graph$Datos)[c(1)] <=> Sin transformar
# .ùúè. unique(DF_Results_Graph_2graph$Datos)[c(1, 4, 5, 6)]] <=> Sin transformar + clr + log-ratio + sqrt
DF_Results_Graph_2graph <- DF_Results_Graph_2graph[DF_Results_Graph_2graph$Datos ==
                                                     c(unique(DF_Results_Graph_2graph$Datos)[1:4]), ]
# => Otros arreglos para la gr√°fica: etiquetas de Var + formato de Cor.
DF_Results_Graph_2graph$Var[DF_Results_Graph_2graph$Var == "equal"] <- "Equal"
DF_Results_Graph_2graph$Var[DF_Results_Graph_2graph$Var == "unequal"] <- "Unequal Type I"
DF_Results_Graph_2graph$Var[DF_Results_Graph_2graph$Var == "unequalALT1"] <- "Unequal Type II"
DF_Results_Graph_2graph$Var[DF_Results_Graph_2graph$Var == "unequalALT2"] <- "Unequal Type III"
DF_Results_Graph_2graph[,'Cor'] = format(round(DF_Results_Graph_2graph[,'Cor'], 1), nsmall = 1)

cat("\014") # Clean console

# Directorio de trabajo principal.
work_dir <- "/Users/aitor/Desktop/RProjects/TFMgit"
setwd(work_dir)

DFtable <- subset(DF_Results_Graph_2graph, select = c(-loc, -stdev, -lambda))
totres = dim(DFtable)[1]
nhead = 15
DFsampletable <- data.table(DFtable)[sample(.N, nhead)]
DFsampletable[, 12] <- round(DFsampletable[, 12], digits = 2)

stargazer(DFsampletable, type = 'latex', summary=FALSE, rownames=FALSE,
          header=FALSE, title=paste0("Muestra aleatoria de ", nhead, " de los ", totres,
                                     " resultados obtenidos para las simulaciones detalladas en "),
          label="tab:TabSim1", font.size = "scriptsize", single.row = TRUE,
          column.sep.width = "-8pt", digits = 4, no.space = TRUE)

# Directorio de trabajo principal.
work_dir <- "/Users/aitor/Desktop/RProjects/TFMgit"
setwd(work_dir)

# ---------------------------------------------

# Sumarios estad√≠sticos de la Potencia y el Tiempo de computaci√≥n seg√∫n el tipo de datos y alpha:
# -----------------------------------------------------------------------------------------------
MethodName <- "MANTA"
# MethodName <- "MANOVA"
for (TipoDatos in unique(DF_Results_Graph_2graph$Datos)){
  for (AlphaSim in unique(DF_Results_Graph_2graph$alpha)){
    
    DFsummary <- DF_Results_Graph_2graph[DF_Results_Graph_2graph$M√©todo == MethodName &
                                           DF_Results_Graph_2graph$Datos == TipoDatos &
                                           DF_Results_Graph_2graph$alpha == AlphaSim, ]
    DFsummary <- DFsummary[, c(14, 15)]
    
    stargazer(DFsummary, type = 'latex', summary=TRUE, rownames=TRUE,
              header=FALSE, title=paste0("Sumario estad√≠stico de la Potencia y el tiempo 
              de computaci√≥n empleado en las simulaciones mvnorm de un conjunto de datos",
              TipoDatos, ", y para un alpha =", AlphaSim, ", mediante el m√©todo ", MethodName),
              label="tab:TabSim1", font.size = "scriptsize", single.row = TRUE,
              column.sep.width = "-8pt", digits = 4, no.space = TRUE)
  }
}

# -----------------------------------------------------------------------------------------------

# Sumario estad√≠stico de la Potencia seg√∫n M√©todo - alpha - Cor - Var: <=???
# --------------------------------------------------------------------
TapplySumVarDF <- data.frame()

SumrzModeloName = unique(DF_Results_Graph_2graph$Modelo)[1]
SumrzMetodoName = unique(DF_Results_Graph_2graph$M√©todo)[1]
SumrzDatosName = unique(DF_Results_Graph_2graph$Datos)[1]
SumrzAlphaName = unique(DF_Results_Graph_2graph$alpha)[1]
SumrzCorName = as.numeric(unique(DF_Results_Graph_2graph$Cor))

for (SumrzCorValue in SumrzCorName){
    
    DF_Results_Graph_2graph[DF_Results_Graph_2graph$Modelo == SumrzModeloName &
                              DF_Results_Graph_2graph$M√©todo == SumrzMetodoName &
                              DF_Results_Graph_2graph$Datos == SumrzDatosName &
                              DF_Results_Graph_2graph$alpha == SumrzalphaValue &
                              DF_Results_Graph_2graph$Cor == SumrzCorValue, ]
    
    TapplySumVar <- tapply(as.numeric(DF_Results_Graph_2graph$Potencia),
                           INDEX = DF_Results_Graph_2graph$Var, FUN = summary)
    SumMin <- c(TapplySumVar$`Equal`[[1]], TapplySumVar$`Unequal Type I`[[1]],
                TapplySumVar$`Unequal Type II`[[1]],TapplySumVar$`Unequal Type III`[[1]])
    Sum2Q <- c(TapplySumVar$`Equal`[[2]], TapplySumVar$`Unequal Type I`[[2]],
                TapplySumVar$`Unequal Type II`[[2]],TapplySumVar$`Unequal Type III`[[2]])
    SumMedian <- c(TapplySumVar$`Equal`[[3]], TapplySumVar$`Unequal Type I`[[3]],
                TapplySumVar$`Unequal Type II`[[3]],TapplySumVar$`Unequal Type III`[[3]]) 
    SumMean <- c(TapplySumVar$`Equal`[[4]], TapplySumVar$`Unequal Type I`[[4]],
                TapplySumVar$`Unequal Type II`[[4]],TapplySumVar$`Unequal Type III`[[4]]) 
    Sum3Q <- c(TapplySumVar$`Equal`[[5]], TapplySumVar$`Unequal Type I`[[5]],
                TapplySumVar$`Unequal Type II`[[5]],TapplySumVar$`Unequal Type III`[[5]]) 
    SumMax <- c(TapplySumVar$`Equal`[[6]], TapplySumVar$`Unequal Type I`[[6]],
                TapplySumVar$`Unequal Type II`[[6]],TapplySumVar$`Unequal Type III`[[6]])

    MetodoNamesCol <- c(rep(SumrzMetodoName, length(VarNamesCol)))
    AlphaNamesCol <- c(rep(SumrzalphaValue, length(VarNamesCol))) 
    CorNamesCol <- c(rep(SumrzCorValue, length(VarNamesCol)))
    VarNamesCol <- c(rownames(data.frame(TapplySumVar)))

    TapplySumVarDFtemp <- data.frame(MetodoNamesCol, AlphaNamesCol, CorNamesCol, VarNamesCol,
                                     SumMin, Sum2Q, SumMedian, SumMean, Sum3Q, SumMax)
    colnames(TapplySumVarDFtemp) <- c("M√©todo", "Alpha", "Cor", "Var",
                                      "Min.", "1st Qu.", "Median", "Mean", "3rd Qu.", "Max.")

    TapplySumVarDF <- rbind(TapplySumVarDF, TapplySumVarDFtemp)
    arrange(TapplySumVarDF, Var, Cor)

}

stargazer(TapplySumVarDF, type = 'latex', summary=FALSE, rownames=TRUE,
              header=FALSE, title=paste0("Sumario estad√≠stico de la Potencia en las diferentes simulaciones ",
                                         SumrzModeloName, " (", SumrzDatosName,"), mediante el m√©todo ", SumrzMetodoName),
              label="tab:TabSim1", font.size = "scriptsize", single.row = TRUE,
              column.sep.width = "-8pt", digits = 4, no.space = TRUE)

# --------------------------------------------------------------------


# Gr√°ficos de densidad de los valores de potencia obtenidos:
# ----------------------------------------------------------

# Directorio de trabajo principal.
work_dir <- "/Users/aitor/Desktop/RProjects/TFMgit"
setwd(work_dir)

# PDF
graph_path = file.path(paste0(getwd(), "/Resultados/Resultados Memoria/Gr√°ficos Densidad Potencia (mvnorm)/Cor Homog√©nea"))
dir.create(graph_path, recursive = TRUE, showWarnings = FALSE)
    
pdf(file = file.path(graph_path, paste0("Densidad de potencia calculada [MANOVA, Sin Transformar, ",
                                        "mvnorm, Group = Var, Grid = alpha - Cor].pdf")),
    width = 16, height = 12)

p <- ggplot(DF_Results_Graph_2graph[DF_Results_Graph_2graph$M√©todo == "MANOVA" &
                                      DF_Results_Graph_2graph$Datos == 
                                      unique(DF_Results_Graph_2graph$Datos)[1] &
                                      DF_Results_Graph_2graph$Modelo == "mvnorm", ],
            aes(x = Potencia, y = Var, fill = Var)) + 
  geom_joy(scale = 8.5) + theme_joy(grid = FALSE) + 
  scale_fill_cyclical(values = c('#0F00C37F', '#635AD57F', '#5A87D57F', '#8CAEE87F')) +
  facet_grid(Cor ~ alpha, labeller = label_both) +
  labs(title = paste0("Gr√°fico de densidad de los valores de potencia estad√≠stica (P), ",
                      "calculados para el m√©todo MANOVA, y agrupados seg√∫n el tipo de varianza (Var) impuesta"),
       subtitle = expression("Simulaciones mvnorm para diferentes combinaciones"~alpha~"- Cor"),
       x = TeX(paste0("Distribuci√≥n de la potencia estad√≠stica (P)"), italic = TRUE),
       y = TeX(paste0("Tipo de varianza (Var)"), italic = TRUE)) +
    theme_light() +
    theme(plot.title = element_text(hjust = 0.5, size = 12, vjust = -5,
                                    margin = margin(0, 0, 30, 0), face = "bold"),
          plot.subtitle = element_text(hjust = 0.5, size = 12, face = "italic"),
          axis.title.x = element_text(size = 12),
          axis.title.y = element_text(size = 12),
          strip.text.x = element_text(size = 10),
          strip.text.y = element_text(size = 10),
          strip.background =element_rect(fill="white"),
          strip.text = element_text(colour = 'black'),
          legend.position = "bottom",
          legend.title = element_text(size = 14),
          legend.text = element_text(size = 6),
          legend.background = element_rect(fill = alpha('lightgray', 0.75)))

print(p)

dev.off()

# Directorio de trabajo principal.
work_dir <- "/Users/aitor/Desktop/RProjects/TFMgit"
setwd(work_dir)

# PDF ALT
graph_path = file.path(paste0(getwd(), "/Resultados/Resultados Memoria/Gr√°ficos Densidad Potencia (mvnorm)/Cor Homog√©nea"))
dir.create(graph_path, recursive = TRUE, showWarnings = FALSE)
    
pdf(file = file.path(graph_path, paste0("Densidad de potencia calculada [Sin Transformar, ",
                                        "mvnorm, Group = Cor, Grid = alpha - Var (Eq, UneqI) - M√©todo].pdf")),
    width = 16, height = 12)

pDF <- DF_Results_Graph_2graph[DF_Results_Graph_2graph$Datos == 
                                      unique(DF_Results_Graph_2graph$Datos)[1] &
                                      DF_Results_Graph_2graph$Var == 
                                      unique(DF_Results_Graph_2graph$Var)[1] |
                                      DF_Results_Graph_2graph$Var == 
                                      unique(DF_Results_Graph_2graph$Var)[2] & 
                                      DF_Results_Graph_2graph$Modelo == "mvnorm", ]
  
p <- ggplot(pDF, aes(x = Potencia, y = Cor, ..scale.., fill = Cor)) + 
  geom_joy(scale = 8.5) + theme_joy(grid = FALSE) +
  scale_fill_cyclical(values = c('#0F00C37F', '#635AD57F', '#5A87D57F', '#8CAEE87F')) +
  facet_grid(Var + M√©todo ~ alpha, labeller = label_both) +
  labs(title = paste0("Gr√°fico de densidad de los valores de potencia estad√≠stica (P), ",
                      "agrupados seg√∫n el tipo de correlaci√≥n (Cor) impuesta en la matriz homog√©nea"),
       subtitle = expression("Simulaciones mvnorm para diferentes combinaciones"~alpha~"- Var - M√©todo"),
       x = TeX(paste0("Distribuci√≥n de la potencia estad√≠stica (P)"), italic = TRUE),
       y = TeX(paste0("Correlaci√≥n utilizada (Cor)"), italic = TRUE)) +
    theme_light() +
    theme(plot.title = element_text(hjust = 0.5, size = 12, vjust = -5,
                                    margin = margin(0, 0, 30, 0), face = "bold"),
          plot.subtitle = element_text(hjust = 0.5, size = 12, face = "italic"),
          axis.title.x = element_text(size = 12),
          axis.title.y = element_text(size = 12),
          strip.text.x = element_text(size = 10),
          strip.text.y = element_text(size = 6),
          strip.background =element_rect(fill="white"),
          strip.text = element_text(colour = 'black'),
          legend.position = "bottom",
          legend.title = element_text(size = 14),
          legend.text = element_text(size = 6),
          legend.background = element_rect(fill = alpha('lightgray', 0.75)))

print(p)

dev.off()

# ----------------------------------------------------------


# # # # # # # # # # # # # # # # # # # # # # #
#           Simulaciones mvnorm             #
#                                           #
#      "Sim. 01-01-2024 22 h 33 min"        #
#                     +                     #
#      "Sim. 09-01-2024 11 h 47 min"        #
#                                           #
# # # # # # # # # # # # # # # # # # # # # # #
#    Matriz de correlaci√≥n inhomog√©nea      #
# (valores aleatorios fuera de la diagonal) #
# # # # # # # # # # # # # # # # # # # # # # #
#         Œ± = (0.05, 0.01, 0.001)           #
# # # # # # # # # # # # # # # # # # # # # # #
# -------------------------------------------
# Directorio de trabajo principal.
work_dir <- "/Users/aitor/Desktop/RProjects/TFMgit"
setwd(work_dir)

# Directorio de la primera simulaci√≥n a representar:
setwd(file.path(getwd(), "Resultados/Modelo mvnorm/Sim. 01-01-2024 22 h 33 min"))
DF_Results_Graph_2graph1 <- read.csv("DF_Results_Graph.csv")

# Directorio de trabajo principal.
work_dir <- "/Users/aitor/Desktop/RProjects/TFMgit"
setwd(work_dir)

# Directorio de la segunda simulaci√≥n a representar:
setwd(file.path(getwd(), "Resultados/Modelo mvnorm/Sim. 09-01-2024 11 h 47 min"))
DF_Results_Graph_2graph2 <- read.csv("DF_Results_Graph.csv")

# Directorio de trabajo principal.
work_dir <- "/Users/aitor/Desktop/RProjects/TFMgit"
setwd(work_dir)

# Directorio de la uni√≥n de simulaciones:
setwd(file.path(getwd(), "Resultados/Modelo mvnorm/Resultados Memoria"))

# Uni√≥n de los DF:
DF_Results_Graph_2graph <- rbind(DF_Results_Graph_2graph1, DF_Results_Graph_2graph2)
DF_Results_Graph_2graph <- DF_Results_Graph_2graph[order(DF_Results_Graph_2graph$M√©todo), ]

## Para mvnorm forzamos que todos los valores de loc y lambda son NA.
DF_Results_Graph_2graph$loc <- c(rep(NA, dim(DF_Results_Graph_2graph)[1]))
DF_Results_Graph_2graph$lambda <- c(rep(NA, dim(DF_Results_Graph_2graph)[1]))

## Para la matriz de correlaci√≥n inhomog√©nea, forzamos que todos los valores de Cor sean "Aleat."
DF_Results_Graph_2graph$Cor <- c(rep(toString("Aleat."), dim(DF_Results_Graph_2graph)[1]))

## Para mvnorm no se aplicar√° ni Yscaled ni YnormMinMax ya que se genera otro estad√≠stico diferente al que se est√° estudiando
## (p_valor) y que, a parte de que no tiene porque ser invariante a transformaciones, NO SIRVE PARA COMPARAR MANTA-MANOVA.
## Para simplex solo se estudiar√° MANTA, as√≠ que no es necesario corregir ni Ylog ni Yclr.

# => Filtramos las transformaciones no necesarias:
# .ùúè. unique(DF_Results_Graph_2graph$Datos)[c(1)] <=> Sin transformar
# .ùúè. unique(DF_Results_Graph_2graph$Datos)[c(1, 4, 5, 6)]] <=> Sin transformar + clr + log-ratio + sqrt
DF_Results_Graph_2graph <- DF_Results_Graph_2graph[DF_Results_Graph_2graph$Datos ==
                                                     c(unique(DF_Results_Graph_2graph$Datos)[1:4]), ]
# => Otros arreglos para la gr√°fica: etiquetas de Var + formato de Cor.
DF_Results_Graph_2graph$Var[DF_Results_Graph_2graph$Var == "equal"] <- "Equal"
DF_Results_Graph_2graph$Var[DF_Results_Graph_2graph$Var == "unequal"] <- "Unequal Type I"
DF_Results_Graph_2graph$Var[DF_Results_Graph_2graph$Var == "unequalALT1"] <- "Unequal Type II"
DF_Results_Graph_2graph$Var[DF_Results_Graph_2graph$Var == "unequalALT2"] <- "Unequal Type III"

cat("\014") # Clean console


DFtable <- subset(DF_Results_Graph_2graph, select = c(-loc, -stdev, -lambda))
totres = dim(DFtable)[1]
nhead = 15
DFsampletable <- data.table(DFtable)[sample(.N, nhead)]
DFsampletable[, 12] <- round(DFsampletable[, 12], digits = 2)

stargazer(DFsampletable, type = 'latex', summary=FALSE, rownames=FALSE,
          header=FALSE, title=paste0("Muestra aleatoria de ", nhead, " de los ", totres,
                                     " resultados obtenidos para las simulaciones detalladas en "),
          label="tab:TabSim1", font.size = "scriptsize", single.row = TRUE,
          column.sep.width = "-8pt", digits = 3, no.space = TRUE)

# Directorio de trabajo principal.
work_dir <- "/Users/aitor/Desktop/RProjects/TFMgit"
setwd(work_dir)

# -------------------------------------------

# Sumarios estad√≠sticos de la Potencia y el Tiempo de computaci√≥n seg√∫n el tipo de datos y alpha:
# -----------------------------------------------------------------------------------------------
# MethodName <- "MANTA"
MethodName <- "MANOVA"
for (TipoDatos in unique(DF_Results_Graph_2graph$Datos)){
  for (AlphaSim in unique(DF_Results_Graph_2graph$alpha)){
    
    DFsummary <- DF_Results_Graph_2graph[DF_Results_Graph_2graph$M√©todo == MethodName &
                                           DF_Results_Graph_2graph$Datos == TipoDatos &
                                           DF_Results_Graph_2graph$alpha == AlphaSim, ]
    DFsummary <- DFsummary[, c(14, 15)]
    
    stargazer(DFsummary, type = 'latex', summary=TRUE, rownames=TRUE,
              header=FALSE, title=paste0("Sumario estad√≠stico de la Potencia y el tiempo 
              de computaci√≥n empleado en las simulaciones mvnorm de un conjunto de datos",
              TipoDatos, ", y para un alpha =", AlphaSim, ", mediante el m√©todo ", MethodName),
              label="tab:TabSim1", font.size = "scriptsize", single.row = TRUE,
              column.sep.width = "-8pt", digits = 4, no.space = TRUE)
  }
}

# -----------------------------------------------------------------------------------------------


# Gr√°ficos de densidad de los valores de potencia obtenidos:
# ----------------------------------------------------------

# Directorio de trabajo principal.
work_dir <- "/Users/aitor/Desktop/RProjects/TFMgit"
setwd(work_dir)

# PDF
graph_path = file.path(paste0(getwd(), "/Resultados/Resultados Memoria/Gr√°ficos Densidad Potencia (mvnorm)/Cor Inhomog√©nea"))
dir.create(graph_path, recursive = TRUE, showWarnings = FALSE)
    
pdf(file = file.path(graph_path, paste0("Densidad de potencia calculada [Sin Transformar, ",
                                        "mvnorm, Group = Var, Grid = alpha - Cor - M√©todo].pdf")),
    width = 16, height = 12)

p <- ggplot(DF_Results_Graph_2graph[DF_Results_Graph_2graph$Datos == 
                                      unique(DF_Results_Graph_2graph$Datos)[1] &
                                      DF_Results_Graph_2graph$Modelo == "mvnorm", ],
            aes(x = Potencia, y = Var, ..scale.., fill = Var)) + 
  geom_joy(scale = 8.5) + theme_joy(grid = FALSE) + 
  scale_fill_cyclical(values = c('#0F00C37F', '#635AD57F', '#5A87D57F', '#8CAEE87F')) +
  facet_grid(Cor + M√©todo ~ alpha, labeller = label_both) +
  labs(title = paste0("Gr√°fico de densidad de los valores de potencia estad√≠stica (P), ",
                      "agrupados seg√∫n el tipo de varianza (Var) impuesta"),
       subtitle = expression("Simulaciones mvnorm para diferentes combinaciones"~alpha~"- Cor (matriz inhomog√©nea) - M√©todo"),
       x = TeX(paste0("Distribuci√≥n de la potencia estad√≠stica (P)"), italic = TRUE),
       y = TeX(paste0("Tipo de varianza (Var)"), italic = TRUE)) +
    theme_light() +
    theme(plot.title = element_text(hjust = 0.5, size = 12, vjust = -5,
                                    margin = margin(0, 0, 30, 0), face = "bold"),
          plot.subtitle = element_text(hjust = 0.5, size = 12, face = "italic"),
          axis.title.x = element_text(size = 12),
          axis.title.y = element_text(size = 12),
          strip.text.x = element_text(size = 10),
          strip.text.y = element_text(size = 10),
          strip.background =element_rect(fill="white"),
          strip.text = element_text(colour = 'black'),
          legend.position = "bottom",
          legend.title = element_text(size = 14),
          legend.text = element_text(size = 6),
          legend.background = element_rect(fill = alpha('lightgray', 0.75)))

print(p)

dev.off()

# ----------------------------------------------------------


# # # # # # # # # # # # # # # # # # # # # # # #
#            Simulaciones s√≠mplex             #
#                                             #
#        "Sim. 02-01-2024 01 h 56 min"        #
#                      +                      #
#        "Sim. 09-01-2024 15 h 59 min"        #
#                                             #
# # # # # # # # # # # # # # # # # # # # # # # #
#                ‚àÜ max = 0.025                #
# # # # # # # # # # # # # # # # # # # # # # # #
#           Œ± = (0.05, 0.01, 0.001)           #
# # # # # # # # # # # # # # # # # # # # # # # #
# ---------------------------------------------
# Directorio de trabajo principal.
work_dir <- "/Users/aitor/Desktop/RProjects/TFMgit"
setwd(work_dir)

# Directorio de la primera simulaci√≥n a representar:
setwd(file.path(getwd(), "Resultados/Modelo simplex/Sim. 02-01-2024 01 h 56 min"))
DF_Results_Graph_2graph1 <- read.csv("DF_Results_Graph.csv")

# Directorio de trabajo principal.
work_dir <- "/Users/aitor/Desktop/RProjects/TFMgit"
setwd(work_dir)

# Directorio de la segunda simulaci√≥n a representar:
setwd(file.path(getwd(), "Resultados/Modelo simplex/Sim. 09-01-2024 15 h 59 min"))
DF_Results_Graph_2graph2 <- read.csv("DF_Results_Graph.csv")

# Directorio de trabajo principal.
work_dir <- "/Users/aitor/Desktop/RProjects/TFMgit"
setwd(work_dir)

# Directorio de la uni√≥n de simulaciones:
setwd(file.path(getwd(), "Resultados/Modelo mvnorm/Resultados Memoria"))

# Uni√≥n de los DF teniendo en cuenta solo MANTA:
DF_Results_Graph_2graph <- rbind(DF_Results_Graph_2graph1[DF_Results_Graph_2graph1$M√©todo == "MANTA", ],
                                 DF_Results_Graph_2graph2[DF_Results_Graph_2graph2$M√©todo == "MANTA", ])
DF_Results_Graph_2graph <- DF_Results_Graph_2graph[order(DF_Results_Graph_2graph$delta), ]

## Para simplex forzamos que todos los valores de Cor y lambda son NA.
DF_Results_Graph_2graph$Cor <- c(rep(NA, dim(DF_Results_Graph_2graph)[1]))
DF_Results_Graph_2graph$lambda <- c(rep(NA, dim(DF_Results_Graph_2graph)[1]))

## Se estudiar√°n los datos sin transformar y las transformaciones log-ratio, sqrt y clr:
DF_Results_Graph_2graph <- DF_Results_Graph_2graph[DF_Results_Graph_2graph$Datos ==
                                                     unique(DF_Results_Graph_2graph$Datos)[1:4], ]

cat("\014") # Clean console

# Directorio de trabajo principal.
work_dir <- "/Users/aitor/Desktop/RProjects/TFMgit"
setwd(work_dir)

DFtable <- subset(DF_Results_Graph_2graph, select = c(-Var, -Cor, -lambda))
totres = dim(DFtable)[1]
nhead = 15
DFsampletable <- data.table(DFtable)[sample(.N, nhead)]
DFsampletable[, 12] <- round(DFsampletable[, 12], digits = 2)

stargazer(DFsampletable, type = 'latex', summary=FALSE, rownames=FALSE,
          header=FALSE, title=paste0("Muestra aleatoria de ", nhead, " de los ", totres,
                                     " resultados obtenidos para las simulaciones detalladas en "),
          label="tab:TabSim1", font.size = "scriptsize", single.row = TRUE,
          column.sep.width = "-8pt", digits = 4, no.space = TRUE)

# Directorio de trabajo principal.
work_dir <- "/Users/aitor/Desktop/RProjects/TFMgit"
setwd(work_dir)

# ---------------------------------------------

# Sumarios estad√≠sticos de la Potencia y el Tiempo de computaci√≥n seg√∫n el tipo de datos y alpha:
# -----------------------------------------------------------------------------------------------
for (TipoDatos in unique(DF_Results_Graph_2graph$Datos)){
  for (AlphaSim in unique(DF_Results_Graph_2graph$alpha)){
    
    DFsummary <- DF_Results_Graph_2graph[DF_Results_Graph_2graph$Datos == TipoDatos &
                                           DF_Results_Graph_2graph$alpha == AlphaSim, ]
    DFsummary <- DFsummary[, c(14, 15)]
    
    stargazer(DFsummary, type = 'latex', summary=TRUE, rownames=TRUE,
              header=FALSE, title=paste0("Sumario estad√≠stico de la Potencia y el tiempo 
              de computaci√≥n empleado en las simulaciones s√≠mplex de un conjunto de datos",
              TipoDatos, ", y para un alpha =", AlphaSim),
              label="tab:TabSim1", font.size = "scriptsize", single.row = TRUE,
              column.sep.width = "-8pt", digits = 4, no.space = TRUE)
  }
}

# Sumarios estad√≠sticos de la Potencia y el Tiempo de computaci√≥n seg√∫n el tipo de datos y alpha:
for (TipoDatos in unique(DF_Results_Graph_2graph$Datos)){
  for (AlphaSim in unique(DF_Results_Graph_2graph$alpha)){
    
    DFsummary <- DF_Results_Graph_2graph[DF_Results_Graph_2graph$Datos == TipoDatos &
                                           DF_Results_Graph_2graph$alpha == AlphaSim, ]
    DFsummary <- DFsummary[, c(14, 15)]
    
    print(summary(DFsummary))
  }
}

# -----------------------------------------------------------------------------------------------

# Gr√°ficos de densidad de los valores de potencia obtenidos:
# ----------------------------------------------------------

# Directorio de trabajo principal.
work_dir <- "/Users/aitor/Desktop/RProjects/TFMgit"
setwd(work_dir)

# PDF
graph_path = file.path(paste0(getwd(), "/Resultados/Resultados Memoria/Gr√°ficos Densidad Potencia (simplex)"))
dir.create(graph_path, recursive = TRUE, showWarnings = FALSE)
    
pdf(file = file.path(graph_path, paste0("Densidad de potencia calculada [Modelo = ",
                                        toString(unique(DFsummary$Modelo)),
                                        ", alpha = ", toString(AlphaSim), "].pdf")),
    width = 16, height = 12)

p <- ggplot(DF_Results_Graph_2graph, aes(x = Potencia, y = Datos, ..scale.., fill = Datos)) + 
  geom_joy(scale = 8.5) + theme_joy(grid = FALSE) + 
  scale_fill_cyclical(values = c('#0F00C37F', '#635AD57F', '#5A87D57F', '#8CAEE87F')) +
  facet_wrap(~ alpha, labeller = label_value) +
  labs(title = paste0("Gr√°fico de densidad de los valores de potencia estad√≠stica (P) ",
                      "calculados para el m√©todo MANTA"),
       subtitle = expression("Simulaciones 3-s√≠mplex para diferentes valores de"~alpha~", y diversos tipos de transformaci√≥n de datos."),
       x = TeX(paste0("Distribuci√≥n de la potencia estad√≠stica (P)"), italic = TRUE),
       y = TeX(paste0("Transformaci√≥n de los datos"), italic = TRUE)) +
    theme_light() +
    theme(plot.title = element_text(hjust = 0.5, size = 12, vjust = -5,
                                    margin = margin(0, 0, 30, 0), face = "bold"),
          plot.subtitle = element_text(hjust = 0.5, size = 12, face = "italic"),
          axis.title.x = element_text(size = 12),
          axis.title.y = element_text(size = 12),
          strip.text.x = element_text(size = 10),
          strip.text.y = element_text(size = 10),
          strip.background =element_rect(fill="white"),
          strip.text = element_text(colour = 'black'),
          legend.position = "bottom",
          legend.title = element_text(size = 14),
          legend.text = element_text(size = 6),
          legend.background = element_rect(fill = alpha('lightgray', 0.75)))

print(p)

dev.off()

# PDF ALT
graph_path = file.path(paste0(getwd(), "/Resultados/Resultados Memoria/Gr√°ficos Densidad Potencia (simplex)"))
dir.create(graph_path, recursive = TRUE, showWarnings = FALSE)
    
pdf(file = file.path(graph_path, paste0("Densidad de potencia calculada [MANTA, ",
                                        "simplex, Group = Datos, Grid = alpha - q - loc].pdf")),
    width = 16, height = 12)

# pDF <- DF_Results_Graph_2graph[DF_Results_Graph_2graph$Datos == 
#                                       unique(DF_Results_Graph_2graph$Datos)[1] &
#                                       DF_Results_Graph_2graph$Var == 
#                                       unique(DF_Results_Graph_2graph$Var)[1] |
#                                       DF_Results_Graph_2graph$Var == 
#                                       unique(DF_Results_Graph_2graph$Var)[2] & 
#                                       DF_Results_Graph_2graph$Modelo == "mvnorm", ]
  
p <- ggplot(DF_Results_Graph_2graph, aes(x = Potencia, y = Datos, ..scale.., fill = Datos)) + 
  geom_joy(scale = 8.5) + theme_joy(grid = FALSE) +
  scale_fill_cyclical(values = c('#0F00C37F', '#635AD57F', '#5A87D57F', '#8CAEE87F')) +
  facet_grid(q + loc ~ alpha, labeller = label_both) +
  labs(title = paste0("Gr√°fico de densidad de los valores de potencia estad√≠stica (P), ",
                      "agrupados seg√∫n el tipo de transformaci√≥n de datos"),
       subtitle = expression("Simulaciones s√≠mplex para diferentes combinaciones"~alpha~"- q - loc"),
       x = TeX(paste0("Distribuci√≥n de la potencia estad√≠stica (P)"), italic = TRUE),
       y = TeX(paste0("Correlaci√≥n utilizada (Cor)"), italic = TRUE)) +
    theme_light() +
    theme(plot.title = element_text(hjust = 0.5, size = 12, vjust = -5,
                                    margin = margin(0, 0, 30, 0), face = "bold"),
          plot.subtitle = element_text(hjust = 0.5, size = 12, face = "italic"),
          axis.title.x = element_text(size = 12),
          axis.title.y = element_text(size = 12),
          strip.text.x = element_text(size = 10),
          strip.text.y = element_text(size = 6),
          strip.background =element_rect(fill="white"),
          strip.text = element_text(colour = 'black'),
          legend.position = "bottom",
          legend.title = element_text(size = 14),
          legend.text = element_text(size = 6),
          legend.background = element_rect(fill = alpha('lightgray', 0.75)))

print(p)

dev.off()

# PDF ALT

    
pdf(file = file.path(graph_path, paste0("Densidad de potencia calculada [Modelo = ",
                                        toString(unique(DFsummary$Modelo)),
                                        ", alpha = ", toString(AlphaSim), "].pdf")),
    width = 16, height = 12)

p <- ggplot(DF_Results_Graph_2graph, aes(x = Potencia, y = Datos, ..scale.., fill = Datos)) + 
  geom_joy(scale = 8.5) + theme_joy(grid = FALSE) + 
  scale_fill_cyclical(values = c('#0F00C37F', '#635AD57F', '#5A87D57F', '#8CAEE87F')) +
  facet_wrap(~ alpha, labeller = label_value) +
  labs(title = paste0("Gr√°fico de densidad de los valores de potencia estad√≠stica (P) ",
                      "calculados para el m√©todo MANTA"),
       subtitle = expression("Simulaciones 3-s√≠mplex para diferentes valores de"~alpha~", y diversos tipos de transformaci√≥n de datos."),
       x = TeX(paste0("Distribuci√≥n de la potencia estad√≠stica (P)"), italic = TRUE),
       y = TeX(paste0("Transformaci√≥n de los datos"), italic = TRUE)) +
    theme_light() +
    theme(plot.title = element_text(hjust = 0.5, size = 12, vjust = -5,
                                    margin = margin(0, 0, 30, 0), face = "bold"),
          plot.subtitle = element_text(hjust = 0.5, size = 12, face = "italic"),
          axis.title.x = element_text(size = 12),
          axis.title.y = element_text(size = 12),
          strip.text.x = element_text(size = 10),
          strip.text.y = element_text(size = 10),
          strip.background =element_rect(fill="white"),
          strip.text = element_text(colour = 'black'),
          legend.position = "bottom",
          legend.title = element_text(size = 14),
          legend.text = element_text(size = 6),
          legend.background = element_rect(fill = alpha('lightgray', 0.75)))

print(p)

dev.off()

# ----------------------------------------------------------


# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #

```
